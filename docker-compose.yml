networks:
  net:

services:

  solr:
    image: vivoweb/vivo-solr:latest
    container_name: vivo-solr
    hostname: solr
    environment:
      - VERBOSE=${VERBOSE}
      - RESET_CORE=${RESET_CORE}
    ports:
      - ${LOCAL_SOLR_PORT}:8983
    volumes:
      - ${LOCAL_SOLR_DATA}:/var/solr/data
    networks:
      - net
    healthcheck:
      test: ["CMD", "curl", "--silent", "--fail", "http://localhost:8983/solr/vivocore/admin/ping"]
      start_period: 5s
      interval: 5s
      timeout: 10s
      retries: 3

  tomcat:
    container_name: vivo
    hostname: vivo
    build:
      context: ./
      dockerfile: Dockerfile
    environment:
      - VERBOSE=${VERBOSE}
      - RESET_HOME=${RESET_HOME}
      - VIVO_HOME=${VIVO_HOME}
      - SOLR_URL=http://solr:8983/solr/vivocore
      - LANGUAGE_FILTER_ENABLED=true
      - SELECTABLE_LOCALES=en_US,de_DE,sr_Latn_RS,ru_RU,fr_CA,en_CA,es,pt_BR
      - LOAD_SAMPLE_DATA=false
      - SAMPLE_DATA_REPO_URL=https://github.com/chenejac/sample-data.git
      - SAMPLE_DATA_BRANCH=reorganization
      - SAMPLE_DATA_DIRECTORY=openvivo
      - CATALINA_OPTS=-Xms2048M -Xmx8192M
    ports:
      - ${LOCAL_VIVO_PORT}:8080
    volumes:
      - ${LOCAL_VIVO_HOME}:${VIVO_HOME}
    depends_on:
      solr:
        condition: service_healthy
    networks:
      - net
